<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="lawtion.dao.AuctionBoardDAO">

   <select id="execTotalCount" resultType="int">
      select count(*) from lawtion_auction_board where sysdate <![CDATA[<]]> edate
   </select>
   
   <select id="execTotalCommentCount" resultType="int">
      select count(*) from lawtion_auction_comment where ano=#{no}
   </select>
   
   <select id="execTotalBiddingCount" resultType="int">
      select count(*) from lawtion_auction_comment where lawyer=2 and ano = #{no}
   </select>
   
   <select id="execTotalSearchCount" resultType="int">
      SELECT count(*) FROM (SELECT * FROM lawtion_auction_board where sysdate <![CDATA[<]]> edate)
       where title||content like '%' || #{param1} || '%' and category like '%' || #{param2} || '%' and area like '%' || #{param3} || '%'
   </select>
   
   <select id="getResultList" resultType="lawtion.vo.AuctionBoardVO">
      select * from (select rownum as rno, no, id, title,
       adate,
       hits, edate, category, area
       from (select * from lawtion_auction_board order by adate desc) where sysdate <![CDATA[<]]> edate)
       where rno BETWEEN #{param1} AND #{param2}
   </select>
   
   <select id="getResultSearchList" resultType="lawtion.vo.AuctionBoardVO">
      select * from (select rownum as rno, no, ,id, title,
       adate,
       hits, edate, category, area from
       (select * from (select * from lawtion_auction_board order by adate desc) where sysdate <![CDATA[<]]> edate)
       where title||content like '%' || #{param3} || '%' and category like '%' || #{param4} || '%' and area like '%' || #{param5} || '%')
       where rno BETWEEN #{param1} AND #{param2}
   </select>
   
   <insert id="getInsertResult">
      insert into lawtion_auction_board 
      values(sequ_lawtion_auction_board.nextval,#{id},#{title},#{content},#{fname},sysdate,0,#{category},#{edate},#{area},#{agree},0)
   </insert>
   
   <select id="getResultVO" resultType="lawtion.vo.AuctionBoardVO">
      select no,id,title,content,fname,to_char(adate,'yyyy-mm-dd hh24:mi'),hits,edate,area,category,bidding,agree
       from lawtion_auction_board where no=#{no}
   </select>
   
   <select id="getResultVOId" resultType="lawtion.vo.AuctionBoardVO">
      select max(no)as no from (select * from lawtion_auction_board where id=#{id} and sysdate <![CDATA[<]]> edate)
   </select>
   
   <select id="getResultVOCount" resultType="int">
      select count(*) from (select * from lawtion_auction_board where id='123' and sysdate <![CDATA[<]]> edate and bidding=0)
   </select>

   <update id="getUpdateHits">
      update lawtion_auction_board set hits = hits+1 where no=#{no}
   </update>
   
   <insert id="getReplyInsertResult">
      insert into lawtion_auction_comment values(sequ_lawtion_auction_comment.nextval,
      #{id},#{content},sysdate,#{ano},#{lawyer},#{cost},0)
   </insert>
   
   <select id="getReplyList" resultType="lawtion.vo.AuctionCommentVO">
      select id,cno,content,cdate,ano,lawyer,cost from lawtion_auction_comment where ano=#{no} order by cno
   </select>
   
   <select id="getReplyListBidding" resultType="lawtion.vo.AuctionCommentVO">
      select id,cno,content,cdate,ano,lawyer,cost from lawtion_auction_comment where id=#{lid} order by cno
   </select>
   
   <select id="getReplyListBiddingIdLawyer" resultType="lawtion.vo.AuctionCommentVO">
      select id,cno,content,cdate,ano,lawyer,cost from lawtion_auction_comment where id=#{sid} and lawyer = 2 and bidding = 0 order by cno
   </select>
   
   <select id="getReplyListBiddingIdLawyerPast" resultType="lawtion.vo.AuctionCommentVO">
      select id,cno,content,cdate,ano,lawyer,cost from lawtion_auction_comment where id=#{sid} and lawyer = 2 and bidding = 1 order by cno
   </select>
   
   <select id="getReplyListBiddingNo" resultType="lawtion.vo.AuctionCommentVO">
      select id,cno,content,cdate,ano,lawyer,cost from lawtion_auction_comment where lawyer=2 and ano = #{no} order by cno
   </select>
   
   <select id="getReplyBiddingId" resultType="lawtion.vo.AuctionCommentVO">
   	  select id from lawtion_auction_comment where ano=#{no} and lawyer=2 and bidding=1
   </select>
   
   <update id="getBiddingSuccess">
   	  update lawtion_auction_comment set bidding = 1 where id = #{lid} and lawyer = 2
   </update>
   
   <update id="getBiddingSuccessBoard">
   	  update lawtion_auction_board set bidding = 1 where id = #{sid}
   </update>
   
   <delete id="getDeleteResult">
      delete lawtion_auction_board where no=#{no}
   </delete>
   
   <select id="WhoAreYou" resultType="int">
      select count(*) from join_normal where id=#{id}
   </select>
   
   <select id="getPastBidding" resultType="lawtion.vo.AuctionCommentVO">
   	  select id,cno,content,cdate,ano,lawyer,cost from (select * from lawtion_auction_comment where ano in (select no from lawtion_auction_board where id=#{sid})) where bidding=1
   </select>
   
   <select id="getPastBiddingCount" resultType="int">
   	  select count(*) from (select * from lawtion_auction_comment where ano in (select no from lawtion_auction_board where id=#{sid})) where bidding=1
   </select>
</mapper>